<!-- templates/surveys/home.html -->
{% extends 'base.html' %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}
{% block content %}
<h1>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞—á–∏</h1>

{% if surveys_with_progress or photo_reports_to_review %}
  <ul class="list-group">
    {% for item in surveys_with_progress %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          üìù {{ item.survey.title }}
          <br>
          <small class="text-muted">
            –ü–ª–∞–Ω / –í—ã–ø–æ–ª–Ω–µ–Ω–æ: 
            <strong>
              {{ item.target|default:"--" }} / {{ item.completed }}
            </strong>
          </small>
        </div>
        <div>
          <a href="{% url 'fill_survey' item.survey.id %}" class="btn btn-sm btn-outline-primary me-2">
            –ó–∞–ø–æ–ª–Ω–∏—Ç—å
          </a>
          <a href="{% url 'results_overview' %}?survey={{ item.survey.id }}" class="btn btn-sm btn-outline-secondary">
            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
          </a>
        </div>
      </li>
    {% endfor %}
    
    {% for item in photo_reports_to_review %}
      {% if item.type == 'photo_report' %}
        <li class="list-group-item d-flex justify-content-between align-items-center" style="background-color: #e7f3ff;">
          <div>
            üì∏ –§–æ—Ç–æ–æ—Ç—á—ë—Ç: {{ item.report.client.full_name }}
            <br>
            <small class="text-muted">
              –°—Ç–∞—Ç—É—Å: <strong>{{ item.report.get_status_display }}</strong>
              {% if item.report.rejected_reason %}
                | –ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞: {{ item.report.rejected_reason }}
              {% endif %}
            </small>
          </div>
          <div>
            {% if user.is_staff %}
              <!-- –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä -->
              <a href="{% url 'review_photo_report' item.report.id %}" class="btn btn-sm btn-outline-warning me-2">
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
              </a>
            {% else %}
              <!-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫ -->
              {% if item.report.status == 'rejected' %}
                <a href="{% url 'create_photo_report' %}" class="btn btn-sm btn-outline-success me-2">
                  –ü–µ—Ä–µ—Å–¥–∞—Ç—å
                </a>
              {% else %}
                <a href="{% url 'create_photo_report' %}" class="btn btn-sm btn-outline-primary me-2">
                  –ó–∞–ø–æ–ª–Ω–∏—Ç—å
                </a>
              {% endif %}
            {% endif %}
          </div>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
{% else %}
  <div class="alert alert-warning">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á.</div>
{% endif %}

<!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç–æ–≤ -->
{% if user_is_moderator %}
  <a href="{% url 'pending_photo_reports' %}" class="btn btn-warning mb-3">üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç—ã</a>
{% else %}
  <a href="{% url 'create_photo_report' %}" class="btn btn-success mb-3">üì∏ –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç</a>
{% endif %}

<div class="mt-4">
  <a href="{% url 'upload_clients' %}" class="btn btn-outline-secondary btn-sm">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ (–¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤)</a>
</div>
<p>–ø—Ä–∏–≤–µ—Ç</p>
{% endblock %}