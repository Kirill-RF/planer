<!-- templates/surveys/results_overview.html -->
{% extends 'base.html' %}
{% block content %}
<h1>Результаты опросов</h1>

<!-- Форма фильтрации -->
<form method="get" class="row g-3 mb-4">
  <div class="col-md-3">
    <label class="form-label">Анкета</label>
    <select name="survey" class="form-select">
      <option value="">Любая</option>
      {% for s in surveys %}
        <option value="{{ s.id }}" {% if s.id == selected_survey %}selected{% endif %}>
          {{ s.title }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Клиент</label>
    <select name="client" class="form-select">
      <option value="">Любой</option>
      {% for c in clients %}
        <option value="{{ c.id }}" {% if c.id == selected_client %}selected{% endif %}>
          {{ c.full_name }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Сотрудник</label>
    <select name="employee" class="form-select">
      <option value="">Любой</option>
      {% for e in employees %}
        <option value="{{ e.id }}" {% if e.id == selected_employee %}selected{% endif %}>
          {{ e.full_name }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3 d-flex align-items-end">
    <select name="view" class="form-select me-2" style="max-width: 180px;">
      <option value="detail" {% if view_mode == 'detail' %}selected{% endif %}>Обычный</option>
      {% if selected_employee %}
        <option value="my_stats" {% if view_mode == 'my_stats' %}selected{% endif %}>Мои анкеты</option>
      {% endif %}
      <option value="company_stats" {% if view_mode == 'company_stats' %}selected{% endif %}>Все анкеты</option>
    </select>
    <button type="submit" class="btn btn-primary">Применить</button>
  </div>
</form>

<!-- Основной контент -->
<div class="row">
  {% if view_mode == 'detail' %}
    <!-- Левая колонка: детали -->
    <div class="{% if my_stats_json or company_stats_json %}col-lg-6{% else %}col-12{% endif %}">
      {% include "surveys/partials/detail_results.html" %}
    </div>

    <!-- Правая колонка: график -->
    {% if selected_survey and company_stats_json %}
	  <div class="col-lg-6 d-none d-lg-block">
		<h4>Статистика по компании</h4>
		{% include "surveys/partials/horizontal_bar_chart.html" with stats_json=company_stats_json chart_id="company" %}
	  </div>
	{% endif %}
  {% elif view_mode == 'my_stats' and my_stats_json %}
    <div class="col-12">
      <h4>Мои результаты</h4>
      {% include "surveys/partials/horizontal_bar_chart.html" with stats_json=my_stats_json chart_id="my" %}
    </div>
  {% elif view_mode == 'company_stats' and company_stats_json %}
    <div class="col-12">
      <h4>Все анкеты компании</h4>
      {% include "surveys/partials/horizontal_bar_chart.html" with stats_json=company_stats_json chart_id="all" %}
    </div>
  {% else %}
    <div class="col-12">
      <div class="alert alert-info">Нет данных для отображения.</div>
    </div>
  {% endif %}
</div>

<a href="{% url 'home' %}" class="btn btn-secondary mt-3">← Назад на главную</a>
{% endblock %}